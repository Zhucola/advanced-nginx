联系作者
- weixin: 363260961
- QQ: 363260961

nginx交流群
-  935629460

使用版本
- CentOS Linux release 7.5.1804 (Core)
- nginx/1.12.2版本
- curl 7.61.0 (x86_64-pc-linux-gnu) libcurl/7.61.0 OpenSSL/1.0.2k zlib/1.2.7

## 目录
* [error_log](#error_log)
* [log_format](#log_format)
* [access_log](#access_log)

# error_log
 ```
  Syntax:	error_log file [level];
  Default:	error_log logs/error.log error;
  Context:	main, http, mail, stream, server, location
 ```
   日志级别严重性从轻到重顺序:debug、info、notice、warn、error、crit、alert、emerg
   
   如果file设置为stderr，nginx将会将日志输出到标准错误输出
   
   设置某个日志级别将会使指定级别和更高级别的日志都被记录下来，如指定error会使nginx记录所有的error、crit、alert、emerg级别消息
   
   debug日志级别需要configure  --with-debug
   
   特殊file值stderr可以将error_log输出到标准错误输出中，不过需要nignx的守护进程设置为off(damemon off;)

# log_format
```
 Syntax:	log_format name [escape=default|json|none] string ...;
 Default: log_format combined "...";
 Context:	http
```
定义日志的格式，access_log默认使用的日志格式名字叫combined，可以定一个名字叫test的日志格式，然后让access_log使用test的日志格式

nginx有一个默认的日志combined
```
log_format combined '$remote_addr - $remote_user [$time_local] '
                    '"$request" $status $body_bytes_sent '
                    '"$http_referer" "$http_user_agent"';
```
   
# access_log
```
 Syntax:	access_log path [format [buffer=size] [gzip[=level]] [flush=time] [if=condition]];
         access_log off;
 Default:	access_log logs/access.log combined;
 Context:	http, server, location, if in location, limit_except
```
  为访问日志设置路径、格式和缓冲区大小。在同一个配置层级里可以指定多个日志，特定值off会取消当前配置层级里面的所有access_log。如果没有指定日志格式则会使用预定义的combined
  
```
  server{
     access_log /tmp/nginx.access combined buffer=64k gzip=9 flush=1m;
  }
```
  如果指定gzip**或者**buffer参数，则写操作会被缓存
  
  buffer的大小不能超过磁盘原子性写入大小
  
  如果写操作缓存被使用，以下会发生实际写入文件的操作
  - 下一个日志没有被缓存
  - 如果到了flush指定的时间
  - 达到指定的buffer大小
  - 工作进程关闭或者打开(kill掉工作进程)
  
  如果gzip参数被使用，则buffer数据会先被压缩，然后再写入文件。gzip参数可以指定为1-9,1为最快，9最慢但是压缩比最大。默认情况下，buffer为64K，gizp为1
  
  如果指定了缓存或者gzip，还指定了flush=1m，则在缓存不超缓存大小的情况下，会在1分钟后写入日志
  
  如果日志数据被压缩，查看日志文件需要使用zcat filename
  
  为了支持gzip功能，系统必须有zlib library模块
  
  如果access_log的路径值使用变量，则不能使用buffer、gzip、flush，否则会报错
  
  如果将nginx日志删掉，启动nginx和reload会新建这个日志文件；如果在运行期间删除nginx文件，则新请求不会创建nginx日志文件;日志路径包含变量的话，会在运行期间创建文件
  
  **注意**，如果更改access_log的format，则要使用log_format定义，然后再使用
  
 ```
  server{
    log_format test '$remote_addr  $status';
    access_log /tmp/nginx_access.log test;
  }
 ```
  
  
  
 
   
